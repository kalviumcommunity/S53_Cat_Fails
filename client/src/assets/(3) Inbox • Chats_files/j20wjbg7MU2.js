;/*FB_PKG_DELIM*/

__d("LSHandleRepliesOnMessageEdit",["LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(b){return d[0]=c.createArray(),c.forEach(c.filter(c.db.table(12).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.threadKey,a[0])&&b.replySourceId===a[1]}),function(a){a=a.item;return d[4]=(d[0].push(a.messageId),d[0])})},function(e){return d[1]=c.i64.of_int32(d[0].length),(c.i64.eq(d[1],c.i64.cast([0,0]))?!0:!1)?c.resolve():c.sequence([function(e){return d[4]=new c.Map(),d[4].set("thread_key",a[0]),d[4].set("message_id",a[1]),d[4].set("reply_message_ids",d[0]),d[5]=c.toJSON(d[4]),c.storedProcedure(b("LSIssueNewTask"),"update_replies_on_message_edit",c.i64.cast([0,753]),d[5],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(e){return d[6]=new c.Map(),d[6].set("thread_key",a[0]),d[6].set("message_id",a[1]),d[6].set("bump_message_ids",d[0]),d[7]=c.toJSON(d[6]),c.storedProcedure(b("LSIssueNewTask"),"update_bump_messages_on_message_edit",c.i64.cast([0,757]),d[7],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}])},function(b){return c.db.table(12).fetch([[[a[1]]],"messageId"]).next().then(function(a,b){var c=a.done;a=a.value;return c?d[2]=void 0:(b=a.item,d[2]=b.subthreadKey)})},function(a){return c.i64.neq(d[2],void 0)?c.forEach(c.db.table(9).fetch([[[d[2]]]]),function(a){return a["delete"]()}):c.resolve()}])},function(a){return c.resolve(e)}])}e.exports=a}),null);